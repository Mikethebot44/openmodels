{"version":3,"sources":["../../src/index.ts","../../src/providers/modal.ts","../../src/providers/base.ts","../../src/streaming.ts","../../src/client.ts"],"sourcesContent":["export { OpenModels, client } from './client';\r\nexport { parseSSEStream, OpenModelsError } from './streaming';\r\nexport { ModalProvider } from './providers/modal';\r\nexport * from './types';\r\n\r\n","import fetch from 'node-fetch';\nimport { BaseProvider } from './base';\nimport { ChatCompletionRequest, EmbeddingRequest, ImageRequest } from '../types';\n\nexport class ModalProvider extends BaseProvider {\n  async chat(request: ChatCompletionRequest): Promise<any> {\n    const url = `${this.config.baseUrl}/chat`;\n    \n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n    };\n    \n    if (this.config.apiKey) {\n      headers['Authorization'] = `Bearer ${this.config.apiKey}`;\n    }\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(request),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Modal API error: ${response.status} ${errorText}`);\n    }\n\n    return response;\n  }\n\n  async embed(request: EmbeddingRequest): Promise<any> {\n    const url = `${this.config.baseUrl}/embed`;\n    \n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n    };\n    \n    if (this.config.apiKey) {\n      headers['Authorization'] = `Bearer ${this.config.apiKey}`;\n    }\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(request),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Modal API error: ${response.status} ${errorText}`);\n    }\n\n    return response;\n  }\n\n  async image(request: ImageRequest): Promise<any> {\n    const url = `${this.config.baseUrl}/image`;\n    \n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n    };\n    \n    if (this.config.apiKey) {\n      headers['Authorization'] = `Bearer ${this.config.apiKey}`;\n    }\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(request),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Modal API error: ${response.status} ${errorText}`);\n    }\n\n    return response;\n  }\n}\n","import { ProviderConfig } from '../types';\n\nexport interface Provider {\n  chat(request: any): Promise<any>;\n  embed(request: any): Promise<any>;\n  image(request: any): Promise<any>;\n}\n\nexport abstract class BaseProvider implements Provider {\n  constructor(protected config: ProviderConfig) {}\n  \n  abstract chat(request: any): Promise<any>;\n  abstract embed(request: any): Promise<any>;\n  abstract image(request: any): Promise<any>;\n}\n","import { StreamChunk } from './types';\n\nexport class OpenModelsError extends Error {\n  constructor(\n    message: string,\n    public status?: number,\n    public code?: string\n  ) {\n    super(message);\n    this.name = 'OpenModelsError';\n  }\n}\n\nexport async function* parseSSEStream(\n  response: any\n): AsyncGenerator<string, void, unknown> {\n  if (!response.body) {\n    throw new OpenModelsError('Response body is null');\n  }\n\n  // Handle node-fetch response\n  const text = await response.text();\n  const lines = text.split('\\n');\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n    \n    if (trimmed === '') continue;\n    if (trimmed === '[DONE]') return;\n    \n    if (trimmed.startsWith('data: ')) {\n      const data = trimmed.slice(6);\n      if (data === '[DONE]') return;\n      \n      try {\n        const parsed: StreamChunk = JSON.parse(data);\n        if (parsed.choices?.[0]?.delta?.content) {\n          yield parsed.choices[0].delta.content;\n        }\n      } catch (e) {\n        // Skip malformed JSON\n        continue;\n      }\n    }\n  }\n}\n","import { ModalProvider } from './providers/modal';\nimport { parseSSEStream, OpenModelsError } from './streaming';\nimport { \n  OpenModelsConfig, \n  ChatCompletionRequest, \n  ChatCompletionResponse,\n  EmbeddingRequest,\n  EmbeddingResponse,\n  ImageRequest,\n  ImageResponse\n} from './types';\n\nexport class OpenModels {\n  private provider: ModalProvider;\n\n  constructor(config: OpenModelsConfig = {}) {\n    this.provider = new ModalProvider({\n      apiKey: config.apiKey,\n      baseUrl: config.baseUrl || 'https://modal.run/api/v1',\n    });\n  }\n\n  async chat(request: ChatCompletionRequest): Promise<ChatCompletionResponse | AsyncGenerator<string, void, unknown>> {\n    try {\n      const response = await this.provider.chat(request);\n      \n      if (request.stream) {\n        return parseSSEStream(response);\n      }\n      \n      const data = await response.json();\n      return data as ChatCompletionResponse;\n    } catch (error) {\n      if (error instanceof Error) {\n        throw new OpenModelsError(error.message);\n      }\n      throw new OpenModelsError('Unknown error occurred');\n    }\n  }\n\n  async embed(request: EmbeddingRequest): Promise<EmbeddingResponse> {\n    try {\n      const response = await this.provider.embed(request);\n      const data = await response.json();\n      return data as EmbeddingResponse;\n    } catch (error) {\n      if (error instanceof Error) {\n        throw new OpenModelsError(error.message);\n      }\n      throw new OpenModelsError('Unknown error occurred');\n    }\n  }\n\n  async image(request: ImageRequest): Promise<ImageResponse> {\n    try {\n      const response = await this.provider.image(request);\n      const data = await response.json();\n      return data as ImageResponse;\n    } catch (error) {\n      if (error instanceof Error) {\n        throw new OpenModelsError(error.message);\n      }\n      throw new OpenModelsError('Unknown error occurred');\n    }\n  }\n}\n\nexport function client(config?: OpenModelsConfig): OpenModels {\n  return new OpenModels(config);\n}\n\n"],"mappings":"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","names":["src_exports","__export","ModalProvider","OpenModels","OpenModelsError","client","parseSSEStream","__toCommonJS","import_node_fetch","BaseProvider","config","ModalProvider","BaseProvider","request","url","headers","response","fetch","errorText","OpenModelsError","message","status","code","parseSSEStream","response","lines","line","trimmed","data","parsed","OpenModels","config","ModalProvider","request","response","parseSSEStream","error","OpenModelsError","client"]}