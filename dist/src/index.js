"use strict";var w=Object.create;var p=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var v=(a,t)=>{for(var s in t)p(a,s,{get:t[s],enumerable:!0})},y=(a,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of P(t))!R.call(a,e)&&e!==s&&p(a,e,{get:()=>t[e],enumerable:!(r=g(t,e))||r.enumerable});return a};var I=(a,t,s)=>(s=a!=null?w(b(a)):{},y(t||!a||!a.__esModule?p(s,"default",{value:a,enumerable:!0}):s,a)),x=a=>y(p({},"__esModule",{value:!0}),a);var q={};v(q,{ModalProvider:()=>n,OpenModels:()=>m,OpenModelsError:()=>o,client:()=>h,parseSSEStream:()=>d});module.exports=x(q);var c=I(require("node-fetch"));var l=class{constructor(t){this.config=t}};var o=class extends Error{constructor(s,r,e){super(s);this.status=r;this.code=e;this.name="OpenModelsError"}};async function*d(a){if(!a.body)throw new o("Response body is null");if(a.status===401)throw new o("Invalid API key. Please check your credentials.",401);if(a.status===403)throw new o("Insufficient credits. Please top up your account.",403);let s=(await a.text()).split(`
`);for(let r of s){let e=r.trim();if(e!==""){if(e==="[DONE]")return;if(e.startsWith("data: ")){let i=e.slice(6);if(i==="[DONE]")return;try{let f=JSON.parse(i);f.choices?.[0]?.delta?.content&&(yield f.choices[0].delta.content)}catch{continue}}}}}var n=class extends l{async chat(t){let s=`${this.config.baseUrl}/chat`,r={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},e=await(0,c.default)(s,{method:"POST",headers:r,body:JSON.stringify(t)});if(!e.ok){let i=await e.text();throw e.status===401?new o("Invalid API key. Please check your credentials.",401):e.status===403?new o("Insufficient credits. Please top up your account.",403):new o(`Modal API error: ${e.status} ${i}`,e.status)}return e}async embed(t){let s=`${this.config.baseUrl}/embed`,r={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},e=await(0,c.default)(s,{method:"POST",headers:r,body:JSON.stringify(t)});if(!e.ok){let i=await e.text();throw e.status===401?new o("Invalid API key. Please check your credentials.",401):e.status===403?new o("Insufficient credits. Please top up your account.",403):new o(`Modal API error: ${e.status} ${i}`,e.status)}return e}async image(t){let s=`${this.config.baseUrl}/image`,r={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},e=await(0,c.default)(s,{method:"POST",headers:r,body:JSON.stringify(t)});if(!e.ok){let i=await e.text();throw e.status===401?new o("Invalid API key. Please check your credentials.",401):e.status===403?new o("Insufficient credits. Please top up your account.",403):new o(`Modal API error: ${e.status} ${i}`,e.status)}return e}async audioTranscribe(t){let s=`${this.config.baseUrl}/transcribe`,r={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},e=await(0,c.default)(s,{method:"POST",headers:r,body:JSON.stringify(t)});if(!e.ok){let i=await e.text();throw e.status===401?new o("Invalid API key. Please check your credentials.",401):e.status===403?new o("Insufficient credits. Please top up your account.",403):new o(`Modal API error: ${e.status} ${i}`,e.status)}return e}async audioSummarize(t){let s=`${this.config.baseUrl}/summarize`,r={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},e=await(0,c.default)(s,{method:"POST",headers:r,body:JSON.stringify(t)});if(!e.ok){let i=await e.text();throw e.status===401?new o("Invalid API key. Please check your credentials.",401):e.status===403?new o("Insufficient credits. Please top up your account.",403):new o(`Modal API error: ${e.status} ${i}`,e.status)}return e}async visionClassify(t){let s=`${this.config.baseUrl}/classify`,r={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},e=await(0,c.default)(s,{method:"POST",headers:r,body:JSON.stringify(t)});if(!e.ok){let i=await e.text();throw e.status===401?new o("Invalid API key. Please check your credentials.",401):e.status===403?new o("Insufficient credits. Please top up your account.",403):new o(`Modal API error: ${e.status} ${i}`,e.status)}return e}};var A={"image-classification":["google/vit-base-patch16-224","facebook/convnext-base-224","openai/clip-vit-base-patch32"],"text-generation":["microsoft/DialoGPT-medium","meta-llama/Llama-3.1-8B-Instruct"],embedding:["sentence-transformers/all-MiniLM-L6-v2"],"audio-transcribe":["openai/whisper-base"],"audio-summarize":["facebook/bart-large-cnn"],"image-generation":["runwayml/stable-diffusion-v1-5"]};function u(a){let t=A[a];if(!t||t.length===0)throw new Error(`No default models configured for task: ${a}`);return t[0]}var m=class{constructor(t={}){if(!t.apiKey)throw new o("API key is required. Please provide an API key in the client configuration.");if(!t.apiKey.startsWith("om_")||t.apiKey.length<10)throw new o('Invalid API key format. API keys must start with "om_" and be at least 10 characters long.');let s=t.baseUrl||"https://tryscout.dev",r=e=>s.includes("modal.run")||s.includes("/api/")?s:s.includes(".")?`${s}/api/${e}`:`https://tryscout.dev/api/${e}`;this.textProvider=new n({apiKey:t.apiKey,baseUrl:r("text")}),this.embedProvider=new n({apiKey:t.apiKey,baseUrl:r("embed")}),this.imageProvider=new n({apiKey:t.apiKey,baseUrl:r("image")}),this.audioProvider=new n({apiKey:t.apiKey,baseUrl:r("audio")}),this.visionProvider=new n({apiKey:t.apiKey,baseUrl:r("vision")})}async chat(t){try{let s=await this.textProvider.chat(t);return t.stream?d(s):await s.json()}catch(s){throw s instanceof Error?new o(s.message):new o("Unknown error occurred")}}async embed(t){try{return await(await this.embedProvider.embed(t)).json()}catch(s){throw s instanceof Error?new o(s.message):new o("Unknown error occurred")}}async image(t){try{return await(await this.imageProvider.image(t)).json()}catch(s){throw s instanceof Error?new o(s.message):new o("Unknown error occurred")}}async run(t){try{switch(t.task){case"text-generation":{let s=t.model||u("text-generation"),r={...t,model:s},e=await this.textProvider.chat(r);return r.stream?d(e):await e.json()}case"image-generation":{let s=t.model||u("image-generation"),r={...t,model:s};return await(await this.imageProvider.image(r)).json()}case"embedding":{let s=t.model||u("embedding"),r={...t,model:s};return await(await this.embedProvider.embed(r)).json()}case"audio-transcribe":{let s=t.model||u("audio-transcribe"),r={...t,model:s};return await(await this.audioProvider.audioTranscribe(r)).json()}case"audio-summarize":{let s=t.model||u("audio-summarize"),r={...t,model:s};return await(await this.audioProvider.audioSummarize(r)).json()}case"image-classification":{let s=t.model||u("image-classification"),r={...t,model:s};return await(await this.visionProvider.visionClassify(r)).json()}default:throw new o("Unsupported task")}}catch(s){throw s instanceof Error?new o(s.message):new o("Unknown error occurred")}}};function h(a){return new m(a)}0&&(module.exports={ModalProvider,OpenModels,OpenModelsError,client,parseSSEStream});
//# sourceMappingURL=index.js.map