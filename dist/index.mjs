import y from"node-fetch";var c=class{constructor(e){this.config=e}};var i=class extends c{async chat(e){let r=`${this.config.baseUrl}/chat`,o={"Content-Type":"application/json"};this.config.apiKey&&(o.Authorization=`Bearer ${this.config.apiKey}`);let n=await y(r,{method:"POST",headers:o,body:JSON.stringify(e)});if(!n.ok){let d=await n.text();throw new Error(`Modal API error: ${n.status} ${d}`)}return n}};var s=class extends Error{constructor(r,o,n){super(r);this.status=o;this.code=n;this.name="OpenModelsError"}};async function*l(t){if(!t.body)throw new s("Response body is null");let e=t.body.getReader(),r=new TextDecoder,o="";try{for(;;){let{done:n,value:d}=await e.read();if(n)break;o+=r.decode(d,{stream:!0});let f=o.split(`
`);o=f.pop()||"";for(let h of f){let a=h.trim();if(a!==""){if(a==="[DONE]")return;if(a.startsWith("data: ")){let u=a.slice(6);if(u==="[DONE]")return;try{let m=JSON.parse(u);m.choices?.[0]?.delta?.content&&(yield m.choices[0].delta.content)}catch{continue}}}}}}finally{e.releaseLock()}}var p=class{constructor(e={}){this.provider=new i({apiKey:e.apiKey,baseUrl:e.baseUrl||"https://modal.run/api/v1"})}async chat(e){try{let r=await this.provider.chat(e);return e.stream?l(r):await r.json()}catch(r){throw r instanceof Error?new s(r.message):new s("Unknown error occurred")}}};function C(t){return new p(t)}export{i as ModalProvider,p as OpenModels,s as OpenModelsError,C as client,l as parseSSEStream};
//# sourceMappingURL=index.mjs.map